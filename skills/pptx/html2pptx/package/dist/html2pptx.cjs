"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const v=require("playwright"),m=require("path"),P=require("node:path"),I=require("node:url"),T=require("pkg-dir"),$=require("fs/promises");var g=typeof document<"u"?document.currentScript:null;const x=.75,w=96,b=914400;async function M(i){const o=await i.evaluate(()=>{const n=document.body,r=window.getComputedStyle(n);return{width:parseFloat(r.width),height:parseFloat(r.height),scrollWidth:n.scrollWidth,scrollHeight:n.scrollHeight}}),a=[],t=Math.max(0,o.scrollWidth-o.width-1),s=Math.max(0,o.scrollHeight-o.height-1),e=t*x,l=s*x;if(e>0||l>0){const n=[];e>0&&n.push(`${e.toFixed(1)}pt horizontally`),l>0&&n.push(`${l.toFixed(1)}pt vertically`);const r=l>0?' (Remember: leave 0.5" margin at bottom of slide)':"";a.push(`HTML content overflows body by ${n.join(" and ")}${r}`)}return{...o,errors:a}}function R(i,o){const a=[],t=i.width/w,s=i.height/w;if(o.presLayout){const e=o.presLayout.width/b,l=o.presLayout.height/b;(Math.abs(e-t)>.1||Math.abs(l-s)>.1)&&a.push(`HTML dimensions (${t.toFixed(1)}" × ${s.toFixed(1)}") don't match presentation layout (${e.toFixed(1)}" × ${l.toFixed(1)}")`)}return a}function _(i,o){const a=[],t=o.height/w,s=.5;for(const e of i.elements)if(["p","h1","h2","h3","h4","h5","h6","list"].includes(e.type)){if(e.type==="line"||e.type==="image"||e.type==="shape")continue;const l=e.style?.fontSize||0,n=e.position.y+e.position.h,r=t-n;if(l>12&&r<s){const h=()=>e.type==="list"?e.items.find(p=>p.text)?.text||"":typeof e.text=="string"?e.text:Array.isArray(e.text)&&e.text.find(p=>p.text)?.text||"",c=h().substring(0,50)+(h().length>50?"...":"");a.push(`Text box "${c}" ends too close to bottom edge (${r.toFixed(2)}" from bottom, minimum ${s}" required)`)}}return a}const k=P.dirname(I.fileURLToPath(typeof document>"u"?require("url").pathToFileURL(__filename).href:g&&g.tagName.toUpperCase()==="SCRIPT"&&g.src||new URL("html2pptx.cjs",document.baseURI).href));async function j(i){const o=await T.packageDirectory({cwd:k});if(!o)throw new Error("[@ant/html2pptx] Internal error, cannot find extraction script");const a=P.join(o,"./dist/playwright/index.iife.js");return await i.addScriptTag({path:a}),await i.evaluate(()=>{const{ExtractSlideData:t}=window;return t.extractSlideDataInBrowser()})}async function B(i,o,a){if(i.background.type==="image"&&i.background.path){let t=i.background.path.startsWith("file://")?i.background.path.replace("file://",""):i.background.path;o.background={path:t}}else i.background.type==="color"&&i.background.value&&(o.background={color:i.background.value})}function D(i,o,a){for(const t of i.elements)if(t.type==="image"){let s=t.src.startsWith("file://")?t.src.replace("file://",""):t.src;o.addImage({path:s,x:t.position.x,y:t.position.y,w:t.position.w,h:t.position.h})}else if(t.type==="line")o.addShape(a.ShapeType.line,{x:t.x1,y:t.y1,w:t.x2-t.x1,h:t.y2-t.y1,line:{color:t.color,width:t.width}});else if(t.type==="shape"){const s={x:t.position.x,y:t.position.y,w:t.position.w,h:t.position.h};t.shape.fill&&(s.fill={color:t.shape.fill},t.shape.transparency!=null&&(s.fill.transparency=t.shape.transparency)),t.shape.line&&(s.line=t.shape.line),t.shape.rectRadius>0&&(s.rectRadius=t.shape.rectRadius),t.shape.shadow&&(s.shadow=t.shape.shadow),o.addText(t.text||"",s)}else if(t.type==="list"){const s={x:t.position.x,y:t.position.y,w:t.position.w,h:t.position.h,fontSize:t.style.fontSize,fontFace:t.style.fontFace,color:t.style.color,align:t.style.align,valign:"top",paraSpaceBefore:t.style.paraSpaceBefore,paraSpaceAfter:t.style.paraSpaceAfter};t.style.lineSpacing!==null&&t.style.lineSpacing!==void 0&&(s.lineSpacing=t.style.lineSpacing),t.style.margin&&(s.margin=t.style.margin),o.addText(t.items,s)}else{const s=t.style.lineSpacing||t.style.fontSize*1.2,e=t.position.h<=s*1.5;let l=t.position.x,n=t.position.w;if(e){const h=t.position.w*.02,c=t.style.align;c==="center"?(l=t.position.x-h/2,n=t.position.w+h):(c==="right"&&(l=t.position.x-h),n=t.position.w+h)}const r={x:l,y:t.position.y,w:n,h:t.position.h,fontSize:t.style.fontSize,fontFace:t.style.fontFace,color:t.style.color,bold:t.style.bold,italic:t.style.italic,valign:"top",paraSpaceBefore:t.style.paraSpaceBefore,paraSpaceAfter:t.style.paraSpaceAfter,inset:0};t.style.underline&&(r.underline={style:"sng",color:t.style.color}),t.style.lineSpacing!==null&&t.style.lineSpacing!==void 0&&(r.lineSpacing=t.style.lineSpacing),t.style.align&&(r.align=t.style.align),t.style.margin&&(r.margin=t.style.margin),t.style.rotate!==null&&t.style.rotate!==void 0&&(r.rotate=t.style.rotate),t.style.transparency!==null&&t.style.transparency!==void 0&&(r.transparency=t.style.transparency),o.addText(t.text,r)}}async function S(i){try{return await $.access(i),!0}catch{return!1}}async function F(){const i=v.chromium.executablePath();if(await S(i))return i;const o=i.split("/"),a=o.findIndex(c=>c.startsWith("chromium-"));if(a===-1)throw new Error(`Could not find chromium revision in path: ${i}`);const t=o[a],s=parseInt(t.replace("chromium-",""),10),e=o.slice(0,a).join("/"),l=o.slice(a+1).join("/");let n=[];try{n=(await $.readdir(e)).filter(p=>p.startsWith("chromium-"))}catch{throw new Error(`Could not read directory: ${e}`)}if(n.length===0)throw new Error(`No chromium installations found in: ${e}`);let r=1/0,h;for(const c of n){const p=parseInt(c.replace("chromium-",""),10),u=Math.abs(p-s);if(u<r){const f=m.join(e,c,l);await S(f)&&(r=u,h=f)}}if(!h)throw new Error(`No valid chromium executable found. Tried ${n.length} alternatives.`);return h}const W=5;async function z(i,o,a={}){const{tmpDir:t=process.env.TMPDIR||"/tmp",slide:s=null}=a;try{const e={env:{TMPDIR:t},executablePath:await F()};process.platform==="darwin"&&(e.channel="chrome");const l=await v.chromium.launch(e);let n,r;const h=m.isAbsolute(i)?i:m.join(process.cwd(),i),c=[];try{const d=await l.newPage();d.on("console",y=>{console.log(`Browser console: ${y.text()}`)}),await d.goto(`file://${h}`),n=await M(d),await d.setViewportSize({width:Math.round(n.width),height:Math.round(n.height)}),r=await j(d)}finally{await l.close()}n.errors&&n.errors.length>0&&c.push(...n.errors);const p=R(n,o);p.length>0&&c.push(...p);const u=_(r,n);if(u.length>0&&c.push(...u),r.errors&&r.errors.length>0&&c.push(...r.errors),c.length>0){const d=c.length===1?c[0]:`Multiple validation errors found:
${c.map((y,E)=>`  ${E+1}. ${y}`).join(`
`)}`;throw new Error(d)}const f=s||o.addSlide();return await B(r,f,t),D(r,f,o),{slide:f,placeholders:r.placeholders}}catch(e){throw e instanceof Error&&!e.message.startsWith(i)?new Error(`${i}: ${e.message}`):e}}exports.Y=W;exports.html2pptx=z;
//# sourceMappingURL=html2pptx.cjs.map
